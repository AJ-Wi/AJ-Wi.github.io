export default class AJWipo{constructor(e="#app"){this.mount=e}render(e="aj-app"){let{mount:t}=this,s=AJWipo.getElement(t);return s&&(s.innerHTML=`<${e}></${e}>`),this}use(e){return e(),this}static getElement(e,t=document){return t.querySelector(e)}static getElementAll(e,t=document){return t.querySelectorAll(e)}static component(e,{template:t,script:s,style:r}){void 0===customElements.get(e)&&customElements.define(e,class extends HTMLElement{constructor(){super(),this.props={}}static get observedAttributes(){if(void 0!==s&&void 0!==s.props)return s.props}attributeChangedCallback(e,t,s){this.props[e]=s}isObjEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}connectedCallback(){if("aj-router"!==e){let t="aj-"+AJWipo.getToken(e);this.injectStyle(t),this.addTemplate(t),void 0!==s&&(void 0!==s.data&&s.data(),void 0!==s.methods&&s.methods(),void 0!==s.created&&s.created())}}addTemplate(e){let s=t;this.isObjEmpty(this.props)||(s=this.replaceProps(s)),""!==this.innerHTML?(s=s.replace(this.regExp("slot"),this.innerHTML),this.innerHTML=""):s=this.replaceSlot(s),this.appendChild(this.applyStyleScopeHTML(s,e))}replaceProps(e){for(const t in this.props)e=e.replace(this.regExp("prop",t),this.props[t]),this.removeAttribute(t);return e}replaceSlot(e){let t=e.search("<slot>")+6,s=e.search("</slot>");return e.replace(this.regExp("slot"),e.substring(t,s))}applyStyleScopeHTML(e,t){let s=document.createRange().createContextualFragment(e);this.classList.add(t),console.log(this.classList);for(let e=0;e<s.children.length;e++)"AJ-ROUTER"!==s.children[e].tagName&&":root"!==s.children[e].tagName&&-1===s.children[e].tagName.search("-")&&this.setClass(s.children[e],t);return s}setClass(e,t){if(e.classList.add(t),e.childElementCount)for(let s=0;s<e.children.length;s++)this.setClass(e.children[s],t)}injectStyle(e){if(void 0!==r){let t=document.querySelector("head");null!==t&&null===t.querySelector(`style[data-token="${e}"]`)&&(r=this.applyStyleScopeCSS(e),t.innerHTML+=`<style data-token=${e}>${r}</style>`)}}applyStyleScopeCSS(e){const t=new CSSStyleSheet;let s="";t.replaceSync(r);for(const r of t.cssRules){if(r.selectorText)":root"!==r.selectorText&&this.editRule(r,e);else if("@key"!==r.cssText.substring(0,4))for(const t of r.cssRules)this.editRule(t,e);s+=r.cssText}return s}editRule(e,t){const s=".:>";let r=e.selectorText.split(/[,\s]/);for(let l=0;l<r.length;l++){if(""!==r[l]){for(let e=0;e<s.length;e++)r[l]=r[l].substring(0,1)+r[l].substring(1).replace(s[e],`.${t}${s[e]}`);-1===r[l].search(`.${t}`)&&-1===r[l].search("[)]")&&-1===r[l].search("[>]")&&(r[l]+=`.${t}`)}else r[l]=",";e.selectorText=r.join(" ")}}regExp(e,t=""){return"prop"===e?new RegExp(`{{${t}}}`,"gi"):"slot"===e?new RegExp("<slot>([A-Z0-9 -_.,])+</slot>","i"):new RegExp(e,"i")}})}static getToken(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZ",s="",r=0;for(let t=0;t<e.length;t++)r+=e.charCodeAt(t);r=parseFloat("0."+r);for(let e=0;e<8;e++){let e=r*t.length;s+=t[Math.floor(e)],r=e%1+.001}return s}}(e=>{"use strict";void 0===e.AJWipo?e.AJWipo=e.AJ=AJWipo:console.log("the bookstore is calling again")})(window);